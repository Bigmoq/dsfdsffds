# ๐ ุฏููู ููู ุชุทุจูู ุฒูุงู ุฅูู Supabase ุฌุฏูุฏ

## ๐ ุงููุชุทูุจุงุช

- ุญุณุงุจ Supabase (ูุฌุงูู ุฃู ูุฏููุน)
- ุงููููุงุช ุงููุทููุจุฉ:
  - `full-schema-export.sql` - ุงูู Schema ูุงูู Policies
  - `data-export.sql` - ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ

---

## ๐ ุงูุฎุทูุงุช

### ุงูุฎุทูุฉ 1: ุฅูุดุงุก ูุดุฑูุน Supabase ุฌุฏูุฏ

1. ุงุฐูุจ ุฅูู [supabase.com](https://supabase.com)
2. ุณุฌู ุงูุฏุฎูู ุฃู ุฃูุดุฆ ุญุณุงุจ ุฌุฏูุฏ
3. ุงุถุบุท **New Project**
4. ุงุฎุชุฑ:
   - **Organization**: ุงุฎุชุฑ ุฃู ุฃูุดุฆ ููุธูุฉ
   - **Project name**: `zafaf` (ุฃู ุฃู ุงุณู ุชุฑูุฏู)
   - **Database Password**: ุงุญูุธ ูููุฉ ุงููุฑูุฑ! โ๏ธ
   - **Region**: ุงุฎุชุฑ ุงูุฃูุฑุจ (ูุซู: `Middle East - Bahrain`)
5. ุงุถุบุท **Create new project**
6. ุงูุชุธุฑ 2-3 ุฏูุงุฆู ุญุชู ูุชู ุฅูุดุงุก ุงููุดุฑูุน

---

### ุงูุฎุทูุฉ 2: ุชูููุฐ ููู ุงูู Schema

1. ูู ููุญุฉ ุชุญูู Supabaseุ ุงุฐูุจ ุฅูู **SQL Editor** (ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ)
2. ุงุถุบุท **New query**
3. ุงูุชุญ ููู `full-schema-export.sql`
4. ุงูุณุฎ **ูู ุงููุญุชูู** ูุงูุตูู ูู ุงููุญุฑุฑ
5. ุงุถุบุท **Run** (ุฃู Ctrl+Enter)
6. ุชุฃูุฏ ูู ุธููุฑ ุฑุณุงูุฉ **Success**

> โ๏ธ **ููุงุญุธุฉ**: ุฅุฐุง ุธูุฑุช ุฃุฎุทุงุกุ ุชุฃูุฏ ูู:
> - ุชูููุฐ ุงูููู ูุฑุฉ ูุงุญุฏุฉ ููุท
> - ุนุฏู ูุฌูุฏ ูุดุงูู ูู ุงูุงุชุตุงู

---

### ุงูุฎุทูุฉ 3: ุฅูุดุงุก ุงููุณุชุฎุฏููู

#### ุฃ. ุฅูุดุงุก ูุณุชุฎุฏู Admin

1. ุงุฐูุจ ุฅูู **Authentication** โ **Users**
2. ุงุถุบุท **Add user** โ **Create new user**
3. ุฃุฏุฎู:
   - **Email**: ุจุฑูุฏู ุงูุฅููุชุฑููู
   - **Password**: ูููุฉ ูุฑูุฑ ูููุฉ
4. โ ูุนูู **Auto Confirm User**
5. ุงุถุบุท **Create user**
6. **ููู ุฌุฏุงู**: ุงูุณุฎ ุงูู **User ID** (ูุซุงู: `a1b2c3d4-e5f6-7890-abcd-ef1234567890`)

#### ุจ. ุฅุถุงูุฉ ุฏูุฑ Admin ูููุณุชุฎุฏู

1. ุงุฐูุจ ุฅูู **SQL Editor**
2. ููุฐ ูุฐุง ุงูุฃูุฑ (ุงุณุชุจุฏู USER_ID):

```sql
-- ุฃุถู ููู ุดุฎุตู ูููุณุชุฎุฏู
INSERT INTO public.profiles (id, full_name, phone, city)
VALUES (
  'USER_ID_HERE',  -- โ ุงุณุชุจุฏู ุจุงูู ID ุงูุฐู ูุณุฎุชู
  'ุงุณู ุงููุฏูุฑ',
  '+966500000000',
  'ุงูุฑูุงุถ'
);

-- ุฃุถู ุฏูุฑ ุงููุณุชุฎุฏู ุงูุฃุณุงุณู
INSERT INTO public.user_roles (user_id, role)
VALUES ('USER_ID_HERE', 'user');

-- ุฃุถู ุฏูุฑ Admin
INSERT INTO public.user_roles (user_id, role)
VALUES ('USER_ID_HERE', 'admin');
```

#### ุฌ. ุฅูุดุงุก ูุณุชุฎุฏููู ุฅุถุงูููู (ุงุฎุชูุงุฑู)

ูุฑุฑ ุงูุฎุทูุงุช ูุฅูุดุงุก:
- **ุตุงุญุจ ูุงุนุฉ**: ุฃุถู ุฏูุฑ `hall_owner`
- **ููุฏู ุฎุฏูุฉ**: ุฃุถู ุฏูุฑ `service_provider`
- **ุจุงุฆุน ูุณุงุชูู**: ุฃุถู ุฏูุฑ `dress_seller`

```sql
-- ูุซุงู: ุฅุถุงูุฉ ุตุงุญุจ ูุงุนุฉ
INSERT INTO public.user_roles (user_id, role)
VALUES ('USER_ID_HERE', 'hall_owner');
```

---

### ุงูุฎุทูุฉ 4: ุฅุถุงูุฉ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ

1. ุงูุชุญ ููู `data-export.sql`
2. **ููู**: ุงุณุชุจุฏู ูู ุงูู `owner_id` ู `seller_id` ุจุงูู IDs ุงูุฌุฏูุฏุฉ

ูุซุงู - ูุจู:
```sql
('1119b8fa-...', '9ed58c5c-b62c-406b-a37f-ea64bb37f5b3', 'ูุงุนุฉ ุงููุงุณุฉ', ...)
                  โ ูุฐุง ุงูู ID ุงููุฏูู
```

ูุซุงู - ุจุนุฏ:
```sql
('1119b8fa-...', 'a1b2c3d4-e5f6-7890-abcd-ef1234567890', 'ูุงุนุฉ ุงููุงุณุฉ', ...)
                  โ ุงูู ID ุงูุฌุฏูุฏ ูู ุงููุณุชุฎุฏู ุงูุฐู ุฃูุดุฃุชู
```

3. ุจุนุฏ ุงูุชุนุฏููุ ุงูุณุฎ ูุงูุตู ูู **SQL Editor** ูุงุถุบุท **Run**

---

### ุงูุฎุทูุฉ 5: ุฑุจุท ุงูุชุทุจูู ุจู Supabase ุงูุฌุฏูุฏ

1. ูู ููุญุฉ ุชุญูู Supabaseุ ุงุฐูุจ ุฅูู **Settings** โ **API**
2. ุงูุณุฎ:
   - **Project URL** (ูุซุงู: `https://abcdefgh.supabase.co`)
   - **anon public key** (ููุชุงุญ ุทููู)

3. ูู ูุดุฑูุนูุ ุฃูุดุฆ ุฃู ุนุฏูู ููู `.env`:

```env
VITE_SUPABASE_URL=https://YOUR_PROJECT_ID.supabase.co
VITE_SUPABASE_PUBLISHABLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

4. ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู

---

### ุงูุฎุทูุฉ 6: ุงูุชุญูู ูู Storage Buckets

1. ุงุฐูุจ ุฅูู **Storage** ูู ููุญุฉ ุงูุชุญูู
2. ุชุฃูุฏ ูู ูุฌูุฏ ุงูู Buckets:
   - โ `hall-images`
   - โ `service-images`
   - โ `dress-images`
   - โ `avatars`
   - โ `chat-images`

> ุฅุฐุง ูู ุชุธูุฑุ ููุฐ ุฌุฒุก Storage ูู ููู `full-schema-export.sql` ูุฑุฉ ุฃุฎุฑู

---

### ุงูุฎุทูุฉ 7: ุฅุนุฏุงุฏุงุช Authentication

1. ุงุฐูุจ ุฅูู **Authentication** โ **Providers**
2. ุชุฃูุฏ ูู ุชูุนูู **Email**
3. (ุงุฎุชูุงุฑู) ูุนูู **Google** ุฅุฐุง ุฃุฑุฏุช ุชุณุฌูู ุงูุฏุฎูู ุจู Google

#### ุฅุนุฏุงุฏุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:
1. ุงุฐูุจ ุฅูู **Authentication** โ **Email Templates**
2. ุนุฏูู ุงูููุงูุจ ุญุณุจ ุงุญุชูุงุฌุงุชู

---

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ

| ุงูุฎุทูุฉ | ุงูุญุงูุฉ |
|--------|--------|
| ุฅูุดุงุก ูุดุฑูุน Supabase | โฌ |
| ุชูููุฐ Schema | โฌ |
| ุฅูุดุงุก ูุณุชุฎุฏู Admin | โฌ |
| ุฅุถุงูุฉ ุฃุฏูุงุฑ ุงููุณุชุฎุฏููู | โฌ |
| ุฅุถุงูุฉ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ | โฌ |
| ุฑุจุท ุงูุชุทุจูู ุจู Supabase | โฌ |
| ุงูุชุญูู ูู Storage | โฌ |
| ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู | โฌ |

---

## ๐ง ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### ูุดููุฉ: "new row violates row-level security policy"
**ุงูุณุจุจ**: ุงูู user_id ุบูุฑ ุตุญูุญ ุฃู ุงููุณุชุฎุฏู ุบูุฑ ูุณุฌู ุงูุฏุฎูู
**ุงูุญู**: ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู ุงูู IDs ุงูุตุญูุญุฉ

### ูุดููุฉ: "relation does not exist"
**ุงูุณุจุจ**: ูู ูุชู ุชูููุฐ ููู Schema
**ุงูุญู**: ููุฐ `full-schema-export.sql` ุฃููุงู

### ูุดููุฉ: ุงูุตูุฑ ูุง ุชุธูุฑ
**ุงูุณุจุจ**: ุงูู Buckets ุบูุฑ ููุฌูุฏุฉ ุฃู ุงูู Policies ุบูุฑ ุตุญูุญุฉ
**ุงูุญู**: ุชุญูู ูู ูุฌูุฏ ุงูู Buckets ูู Storage

### ูุดููุฉ: "duplicate key value violates unique constraint"
**ุงูุณุจุจ**: ุงูุจูุงูุงุช ููุฌูุฏุฉ ูุณุจูุงู
**ุงูุญู**: ุงุญุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ ุฃู ุชุฌุงูู ุงูุฎุทุฃ

---

## ๐ ุงููุณุงุนุฏุฉ

ุฅุฐุง ูุงุฌูุช ูุดุงูู:
1. ุชุญูู ูู Console ูู ุงููุชุตูุญ (F12)
2. ุฑุงุฌุน Logs ูู Supabase Dashboard
3. ุชุฃูุฏ ูู ุตุญุฉ ุงูู Environment Variables

---

## ๐ ูููู ุงููููุงุช

```
public/
โโโ full-schema-export.sql   # Schema + Types + Policies + Storage
โโโ data-export.sql          # ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ
โโโ MIGRATION_GUIDE.md       # ูุฐุง ุงูุฏููู
```

---

**ุขุฎุฑ ุชุญุฏูุซ**: 2026-02-09
